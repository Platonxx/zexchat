<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zexchat - Anonymous Random Chat</title>

    <meta name="description" content="Zexchat - Connect with strangers for free, anonymous random chats anytime. Start talking now!">
    <meta name="author" content="Zexchat Team">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Zexchat - Anonymous Chat">
    <meta property="og:description" content="Connect with strangers for free, anonymous random chats anytime. Start talking now!">
    <meta property="og:image" content="https://zexchat.com/images/zexchat-banner.png">
    <meta property="og:url" content="https://zexchat.com">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Zexchat - Anonymous Chat">
    <meta name="twitter:description" content="Connect with strangers for free, anonymous random chats anytime. Start talking now!">
    <meta name="twitter:image" content="https://zexchat.com/images/zexchat-banner.png">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://zexchat.com">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Zexchat - Anonymous Random Chat</h1>
    <p>Finding an opponent... Online: <span id="online-count">1</span></p>

    <div id="chat-container"></div>

    <input type="text" id="message-input" placeholder="Type a message..." aria-label="Message input">
    <button id="send-btn" aria-label="Send message">â–¶ Send</button>

    <!-- ì¶”ê°€ì ì¸ SEOë¥¼ ìœ„í•œ ìˆ¨ê²¨ì§„ ì†Œê°œ í…ìŠ¤íŠ¸ -->
    <div id="intro-text" style="display: none;">
        <p>Welcome to Zexchat, your go-to place for anonymous random chats. 
        Meet new people and chat with strangers instantly, without registration.</p>
    </div>

    <!-- Schema.org êµ¬ì¡°í™” ë°ì´í„° -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ChatRoom",
      "name": "Zexchat",
      "url": "https://zexchat.com",
      "description": "Zexchat - Connect with strangers for free, anonymous random chats anytime. Start talking now!"
    }
    </script>

    <!-- âœ… JavaScript ì½”ë“œ ì¶”ê°€ -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const messageInput = document.getElementById("message-input");
            const sendButton = document.getElementById("send-btn");
            const chatContainer = document.getElementById("chat-container");
            const statusIndicator = document.createElement("p");
            document.body.insertBefore(statusIndicator, chatContainer);

            // âœ… WebSocket ì—°ê²°
            const SOCKET_URL = "https://zexchat-backend.onrender.com"; // ì‹¤ì œ ë°±ì—”ë“œ ì£¼ì†Œ
            const socket = io(SOCKET_URL, {
                transports: ["websocket", "polling"], // WebSocket ìš°ì„ 
                pingInterval: 25000,
                pingTimeout: 5000,
            });

            // âœ… ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
            socket.on("connect", () => {
                console.log("Connected to server:", socket.id);
                statusIndicator.textContent = "ğŸŸ¢ Connected";
            });

            socket.on("disconnect", () => {
                console.log("Disconnected from server");
                statusIndicator.textContent = "ğŸ”´ Disconnected";
            });

            socket.on("connect_error", (err) => {
                console.error("Connection error:", err);
                statusIndicator.textContent = "âš ï¸ Connection failed!";
            });

            // âœ… ë©”ì‹œì§€ ì…ë ¥ ë° ì „ì†¡
            sendButton.addEventListener("click", sendMessage);
            messageInput.addEventListener("keypress", function (event) {
                if (event.key === "Enter" && !event.shiftKey) {
                    event.preventDefault(); // ê¸°ë³¸ ì—”í„° ì…ë ¥ ë°©ì§€
                    sendMessage();
                }
            });

            function sendMessage() {
                const message = messageInput.value.trim();
                if (message === "") return;

                displayMessage("You", message, "user-message");

                // âœ… WebSocketì„ ì‚¬ìš©í•´ ë©”ì‹œì§€ ì „ì†¡
                socket.emit("message", { text: message });

                messageInput.value = "";
                adjustTextareaHeight(); // ì…ë ¥ í›„ ë†’ì´ ì´ˆê¸°í™”
            }

            function displayMessage(sender, text, className) {
                const messageElement = document.createElement("div");
                messageElement.classList.add("message", className);
                messageElement.innerHTML = `<strong>${sender}:</strong> ${text}`;
                chatContainer.appendChild(messageElement);
                chatContainer.scrollTop = chatContainer.scrollHeight; // ìŠ¤í¬ë¡¤ ìë™ ì´ë™
            }

            // âœ… ì„œë²„ì—ì„œ ë©”ì‹œì§€ ë°›ê¸°
            socket.on("message", (data) => {
                displayMessage("Partner", data.text, "partner-message");
            });

            // âœ… ì…ë ¥ì°½ ìë™ í¬ê¸° ì¡°ì •
            messageInput.addEventListener("input", adjustTextareaHeight);

            function adjustTextareaHeight() {
                messageInput.style.height = "auto";
                messageInput.style.height = `${Math.min(messageInput.scrollHeight, 120)}px`; // ìµœëŒ€ 120px ì œí•œ
            }
        });
    </script>
</body>
</html>